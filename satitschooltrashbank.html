<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Ç‡∏¢‡∏∞</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-purple-100 min-h-screen">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-lg p-8 w-full max-w-md">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                </div>
                <h1 class="text-2xl font-bold text-gray-800 mb-2">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Ç‡∏¢‡∏∞</h1>
                <p class="text-gray-600">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤‡∏ò‡∏¥‡∏ï‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡∏ô‡∏Ñ‡∏£‡∏£‡∏∞‡∏¢‡∏≠‡∏á (‡∏ß‡∏±‡∏î‡∏ï‡∏£‡∏µ‡∏£‡∏±‡∏ï‡∏ô‡∏≤‡∏£‡∏≤‡∏°)</p>
                <p class="text-sm text-gray-500 mt-2">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</p>
            </div>
            
            <form onsubmit="login(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                    <input type="text" id="username" required placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                    <input type="password" id="password" required placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
                <button type="submit" class="w-full bg-purple-500 text-white py-2 px-4 rounded-lg hover:bg-purple-600 transition-colors">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            </form>
            
            <div id="loginError" class="mt-4 p-3 bg-red-100 text-red-700 rounded-lg hidden">
                ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
            </div>
            

        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="container mx-auto px-4 py-8 hidden">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <div class="text-center mb-4">
                <h1 class="text-3xl font-bold text-gray-800">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Ç‡∏¢‡∏∞</h1>
                <p class="text-lg font-medium text-purple-600 mt-2">‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ 1/2568</p>
            </div>
            <p class="text-gray-600 text-center mb-4">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤‡∏ò‡∏¥‡∏ï‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡∏ô‡∏Ñ‡∏£‡∏£‡∏∞‡∏¢‡∏≠‡∏á (‡∏ß‡∏±‡∏î‡∏ï‡∏£‡∏µ‡∏£‡∏±‡∏ï‡∏ô‡∏≤‡∏£‡∏≤‡∏°)</p>
            <div class="flex items-center justify-center">
                <div class="text-center">
                    <div class="flex items-center gap-2 text-sm text-gray-600 justify-center">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        <span id="currentUser"></span>
                    </div>
                    <div class="text-xs text-gray-500" id="loginTime"></div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="bg-white rounded-lg shadow-lg p-4 mb-8">
        <div class="flex flex-wrap gap-2 justify-center items-center">
            <!-- üîò ‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å -->
            <button onclick="showTab('students')" id="studentsTab" class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
            <button onclick="showTab('transaction')" id="transactionTab" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">‡∏ù‡∏≤‡∏Å/‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</button>
            <button onclick="showTab('summary')" id="summaryTab" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</button>
            <button onclick="showTab('history')" id="historyTab" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
            <button onclick="showTab('balance')" id="balanceTab" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</button>
        </div>

        <!-- ‚úÖ ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å (‡∏ß‡∏≤‡∏á‡πÉ‡∏ï‡πâ‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å ‡πÅ‡∏ï‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ logout) -->
        <div class="flex flex-wrap gap-2 justify-center items-center mt-4">
            <select id="summaryGrade" class="px-2 py-1 border rounded">
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô --</option>
            <option value="‡∏≠.1">‡∏≠.1</option>
            <option value="‡∏≠.2">‡∏≠.2</option>
            <option value="‡∏≠.3">‡∏≠.3</option>
            <option value="‡∏õ.1">‡∏õ.1</option>
            <option value="‡∏õ.2">‡∏õ.2</option>
            <option value="‡∏õ.3">‡∏õ.3</option>
            <option value="‡∏õ.4">‡∏õ.4</option>
            <option value="‡∏õ.5">‡∏õ.5</option>
            <option value="‡∏õ.6">‡∏õ.6</option>
            </select>

            <select id="summaryRoom" class="px-2 py-1 border rounded">
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô --</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            </select>

            <button onclick="exportSummaryOfSelectedClass()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
            ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ
            </button>
        </div>
        

        <!-- üî¥ ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö -->
        <div class="flex justify-center gap-2 items-center mt-4">
            <button onclick="logout()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
            ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
    </div>




        <!-- Students Management Tab -->
        <div id="studentsContent" class="tab-content">
            <div class="grid md:grid-cols-2 gap-8 mb-8">
                <!-- Add Student Form -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Ç‡∏¢‡∏∞</h2>
                    <form onsubmit="addStudent(event)" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</label>
                            <select id="studentGrade" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô --</option>
                                <option value="‡∏≠.1">‡∏≠.1</option>
                                <option value="‡∏≠.2">‡∏≠.2</option>
                                <option value="‡∏≠.3">‡∏≠.3</option>
                                <option value="‡∏õ.1">‡∏õ.1</option>
                                <option value="‡∏õ.2">‡∏õ.2</option>
                                <option value="‡∏õ.3">‡∏õ.3</option>
                                <option value="‡∏õ.4">‡∏õ.4</option>
                                <option value="‡∏õ.5">‡∏õ.5</option>
                                <option value="‡∏õ.6">‡∏õ.6</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                            <select id="studentRoom" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô --</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô: ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡∏≤)</label>
                            <input type="text" id="studentName" required placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</label>
                            <input type="date" id="joinDate" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <button type="submit" class="w-full bg-purple-500 text-white py-2 px-4 rounded-lg hover:bg-purple-600 transition-colors">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                    </form>
                </div>

                <!-- Students List -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
                    <div class="mb-4">
                        <div class="flex gap-2">
                            <input type="text" id="searchStudent" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô..." onkeyup="searchStudents()" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <select id="filterGrade" onchange="filterStudents()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="">‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö</option>
                                <option value="‡∏≠.1">‡∏≠.1</option>
                                <option value="‡∏≠.2">‡∏≠.2</option>
                                <option value="‡∏≠.3">‡∏≠.3</option>
                                <option value="‡∏õ.1">‡∏õ.1</option>
                                <option value="‡∏õ.2">‡∏õ.2</option>
                                <option value="‡∏õ.3">‡∏õ.3</option>
                                <option value="‡∏õ.4">‡∏õ.4</option>
                                <option value="‡∏õ.5">‡∏õ.5</option>
                                <option value="‡∏õ.6">‡∏õ.6</option>
                            </select>
                        </div>
                    </div>
                    <div id="studentsList" class="space-y-2 max-h-96 overflow-y-auto">
                        <!-- Students will be displayed here -->
                    </div>
                </div>
            </div>
            
            <!-- Bulk Remove Section -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">‡πÄ‡∏≠‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</h2>
                <div class="grid md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</label>
                        <select id="removeGrade" onchange="updateRemoveStudentList()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô --</option>
                            <option value="‡∏≠.1">‡∏≠.1</option>
                            <option value="‡∏≠.2">‡∏≠.2</option>
                            <option value="‡∏≠.3">‡∏≠.3</option>
                            <option value="‡∏õ.1">‡∏õ.1</option>
                            <option value="‡∏õ.2">‡∏õ.2</option>
                            <option value="‡∏õ.3">‡∏õ.3</option>
                            <option value="‡∏õ.4">‡∏õ.4</option>
                            <option value="‡∏õ.5">‡∏õ.5</option>
                            <option value="‡∏õ.6">‡∏õ.6</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                        <select id="removeRoom" onchange="updateRemoveStudentList()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô --</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button onclick="toggleSelectAll()" id="selectAllBtn" class="w-full bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 transition-colors">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    </div>
                </div>
                <div id="removeStudentsList" class="space-y-2 max-h-64 overflow-y-auto mb-4 border border-gray-200 rounded-lg p-4">
                    <p class="text-gray-500 text-center">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="removeSelectedStudents()" class="bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 transition-colors">‡πÄ‡∏≠‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
                    <span id="selectedCount" class="flex items-center text-sm text-gray-600">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 0 ‡∏Ñ‡∏ô</span>
                </div>
            </div>
        </div>

        <!-- Transaction Tab -->
        <div id="transactionContent" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-lg p-6 max-w-2xl mx-auto">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">‡∏ù‡∏≤‡∏Å/‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</h2>
                <form onsubmit="processTransaction(event)" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</label>
                        <select id="transactionGrade" onchange="updateTransactionStudentSelect()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">-- ‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö --</option>
                            <option value="‡∏≠.1">‡∏≠.1</option>
                            <option value="‡∏≠.2">‡∏≠.2</option>
                            <option value="‡∏≠.3">‡∏≠.3</option>
                            <option value="‡∏õ.1">‡∏õ.1</option>
                            <option value="‡∏õ.2">‡∏õ.2</option>
                            <option value="‡∏õ.3">‡∏õ.3</option>
                            <option value="‡∏õ.4">‡∏õ.4</option>
                            <option value="‡∏õ.5">‡∏õ.5</option>
                            <option value="‡∏õ.6">‡∏õ.6</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                        <select id="transactionRoom" onchange="updateTransactionStudentSelect()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">-- ‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á --</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                        <select id="transactionStudent" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô --</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                        <input type="date" id="transactionDate" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                        <select id="transactionType" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó --</option>
                            <option value="deposit">‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</option>
                            <option value="withdraw">‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                        <input type="number" id="transactionAmount" min="1" step="0.01" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                        <input type="text" id="transactionNote" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <button type="submit" class="w-full bg-purple-500 text-white py-2 px-4 rounded-lg hover:bg-purple-600 transition-colors">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                </form>
            </div>
        </div>

        <!-- Daily Summary Tab -->
        <div id="summaryContent" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h2>
                <div class="grid md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input type="date" id="summaryDate" onchange="generateDailySummary()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</label>
                        <select id="summaryGrade" onchange="generateDailySummary()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">-- ‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö --</option>
                            <option value="‡∏≠.1">‡∏≠.1</option>
                            <option value="‡∏≠.2">‡∏≠.2</option>
                            <option value="‡∏≠.3">‡∏≠.3</option>
                            <option value="‡∏õ.1">‡∏õ.1</option>
                            <option value="‡∏õ.2">‡∏õ.2</option>
                            <option value="‡∏õ.3">‡∏õ.3</option>
                            <option value="‡∏õ.4">‡∏õ.4</option>
                            <option value="‡∏õ.5">‡∏õ.5</option>
                            <option value="‡∏õ.6">‡∏õ.6</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                        <select id="summaryRoom" onchange="generateDailySummary()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">-- ‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á --</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                </div>
                <div id="dailySummaryResult" class="space-y-4">
                    <!-- Summary will be displayed here -->
                </div>
            </div>
        </div>

        <!-- History Tab -->
        <div id="historyContent" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h2>
                <div class="grid md:grid-cols-4 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                        <select id="historyStudent" onchange="filterHistory()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">-- ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô --</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</label>
                        <select id="historyGrade" onchange="updateHistoryStudentSelect(); filterHistory()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">-- ‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö --</option>
                            <option value="‡∏≠.1">‡∏≠.1</option>
                            <option value="‡∏≠.2">‡∏≠.2</option>
                            <option value="‡∏≠.3">‡∏≠.3</option>
                            <option value="‡∏õ.1">‡∏õ.1</option>
                            <option value="‡∏õ.2">‡∏õ.2</option>
                            <option value="‡∏õ.3">‡∏õ.3</option>
                            <option value="‡∏õ.4">‡∏õ.4</option>
                            <option value="‡∏õ.5">‡∏õ.5</option>
                            <option value="‡∏õ.6">‡∏õ.6</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                        <select id="historyRoom" onchange="updateHistoryStudentSelect(); filterHistory()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">-- ‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á --</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input type="date" id="historyDate" onchange="filterHistory()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                </div>
                <div id="historyResult" class="overflow-x-auto">
                    <!-- History will be displayed here -->
                </div>
            </div>
        </div>

        <!-- Balance Tab -->
        <div id="balanceContent" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
                <div class="grid md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</label>
                        <select id="balanceGrade" onchange="generateBalanceReport()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">-- ‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö --</option>
                            <option value="‡∏≠.1">‡∏≠.1</option>
                            <option value="‡∏≠.2">‡∏≠.2</option>
                            <option value="‡∏≠.3">‡∏≠.3</option>
                            <option value="‡∏õ.1">‡∏õ.1</option>
                            <option value="‡∏õ.2">‡∏õ.2</option>
                            <option value="‡∏õ.3">‡∏õ.3</option>
                            <option value="‡∏õ.4">‡∏õ.4</option>
                            <option value="‡∏õ.5">‡∏õ.5</option>
                            <option value="‡∏õ.6">‡∏õ.6</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                        <select id="balanceRoom" onchange="generateBalanceReport()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">-- ‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á --</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                </div>
                <div id="balanceResult" class="overflow-x-auto">
                    <!-- Balance will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-purple-800 text-white py-4 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p class="text-lg mb-4">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤‡∏ò‡∏¥‡∏ï‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡∏ô‡∏Ñ‡∏£‡∏£‡∏∞‡∏¢‡∏≠‡∏á (‡∏ß‡∏±‡∏î‡∏ï‡∏£‡∏µ‡∏£‡∏±‡∏ï‡∏ô‡∏≤‡∏£‡∏≤‡∏°)</p>
            <div class="flex flex-col md:flex-row justify-center items-center gap-6 text-gray-300">
                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                    </svg>
                    <span>038-016934</span>
                </div>
                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                    </svg>
                    <span>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤‡∏ò‡∏¥‡∏ï‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡∏ô‡∏Ñ‡∏£‡∏£‡∏∞‡∏¢‡∏≠‡∏á (‡∏ß‡∏±‡∏î‡∏ï‡∏£‡∏µ‡∏£‡∏±‡∏ï‡∏ô‡∏≤‡∏£‡∏≤‡∏°)</span>
                </div>
            </div>
        </div>
    </footer>

    <script>


        // Authentication system
        const validUsers = {};
        
        // Generate 72 teacher accounts
        function generateTeacherAccounts() {
            // Kindergarten (‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•) - k1, k2, k3 with rooms 1-8 each = 24 accounts
            for (let grade = 1; grade <= 3; grade++) {
                for (let room = 1; room <= 8; room++) {
                    const username = `teacherk${grade}${room}`;
                    validUsers[username] = {
                        password: username,
                        displayName: `‡∏Ñ‡∏£‡∏π‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• ${grade}/${room}`,
                        level: '‡∏≠.' + grade,
                        room: room.toString()
                    };
                }
            }
            
            // Primary (‡∏õ‡∏£‡∏∞‡∏ñ‡∏°) - p1, p2, p3, p4, p5, p6 with rooms 1-8 each = 48 accounts
            for (let grade = 1; grade <= 6; grade++) {
                for (let room = 1; room <= 8; room++) {
                    const username = `teacherp${grade}${room}`;
                    validUsers[username] = {
                        password: username,
                        displayName: `‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏ñ‡∏° ${grade}/${room}`,
                        level: '‡∏õ.' + grade,
                        room: room.toString()
                    };
                }
            }
        }
        
        // Initialize teacher accounts
        generateTeacherAccounts();
        
        // Current user session
        let currentUser = null;
        
        // Login function
        function login(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('loginError');
            
            if (validUsers[username] && validUsers[username].password === password) {
                currentUser = {
                    username: username,
                    ...validUsers[username],
                    loginTime: new Date()
                };
                
                // Store session
                sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // Hide login screen and show main app
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                
                // Update user info display
                updateUserDisplay();
                
                // Clear login form
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                errorDiv.classList.add('hidden');
                
            } else {
                errorDiv.classList.remove('hidden');
                setTimeout(() => {
                    errorDiv.classList.add('hidden');
                }, 3000);
            }
        }
        
        // Logout function
        function logout() {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                currentUser = null;
                sessionStorage.removeItem('currentUser');
                
                // Show login screen and hide main app
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
                
                // Clear forms
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
            }
        }
        
        // Update user display
        function updateUserDisplay() {
            if (currentUser) {
                document.getElementById('currentUser').textContent = currentUser.displayName;
                document.getElementById('loginTime').textContent = 
                    '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö: ' + currentUser.loginTime.toLocaleString('th-TH');
            }
        }
        
        // Check session on page load
        function checkSession() {
            const savedUser = sessionStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                updateUserDisplay();
            }
        }

        // Data storage
        let students = JSON.parse(localStorage.getItem('students')) || [];
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is already logged in
            checkSession();
            
            document.getElementById('transactionDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('summaryDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('joinDate').value = new Date().toISOString().split('T')[0];
            updateStudentsList();
            updateTransactionStudentSelect();
            updateHistoryStudentSelect();
            generateDailySummary();
            generateBalanceReport();
            

        });





        // Tab management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('button[id$="Tab"]').forEach(btn => {
                btn.classList.remove('bg-purple-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });

            // Show selected tab
            document.getElementById(tabName + 'Content').classList.remove('hidden');
            document.getElementById(tabName + 'Tab').classList.remove('bg-gray-200', 'text-gray-700');
            document.getElementById(tabName + 'Tab').classList.add('bg-purple-500', 'text-white');

            // Refresh data for specific tabs
            if (tabName === 'history') filterHistory();
            if (tabName === 'balance') generateBalanceReport();
            if (tabName === 'summary') generateDailySummary();
        }

        // Student management
        function addStudent(event) {
            event.preventDefault();
            const name = document.getElementById('studentName').value;
            const grade = document.getElementById('studentGrade').value;
            const room = document.getElementById('studentRoom').value;
            const joinDate = document.getElementById('joinDate').value;
            const className = grade + '/' + room;

            // Generate student ID automatically
            const id = Date.now().toString();

            const student = {
                id: id,
                name: name,
                class: className,
                joinDate: joinDate,
                balance: 0,
                createdAt: new Date().toISOString()
            };

            students.push(student);
            localStorage.setItem('students', JSON.stringify(students));
            
            // Reset form
            document.getElementById('studentName').value = '';
            document.getElementById('studentGrade').value = '';
            document.getElementById('studentRoom').value = '';
            document.getElementById('joinDate').value = new Date().toISOString().split('T')[0];

            updateStudentsList();
            updateTransactionStudentSelect();
            updateHistoryStudentSelect();
            alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Ç‡∏¢‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }

        function deleteStudent(studentId) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                students = students.filter(s => s.id !== studentId);
                transactions = transactions.filter(t => t.studentId !== studentId);
                
                localStorage.setItem('students', JSON.stringify(students));
                localStorage.setItem('transactions', JSON.stringify(transactions));
                
                updateStudentsList();
                updateTransactionStudentSelect();
                updateHistoryStudentSelect();
                generateBalanceReport();
                alert('‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            }
        }

        function updateStudentsList() {
            const container = document.getElementById('studentsList');
            if (students.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>';
                return;
            }

            let filteredStudents = students;
            
            // Apply search filter
            const searchTerm = document.getElementById('searchStudent')?.value.toLowerCase() || '';
            if (searchTerm) {
                filteredStudents = filteredStudents.filter(student => 
                    student.name.toLowerCase().includes(searchTerm)
                );
            }
            
            // Apply grade filter
            const gradeFilter = document.getElementById('filterGrade')?.value || '';
            if (gradeFilter) {
                filteredStudents = filteredStudents.filter(student => {
                    const [studentGrade] = student.class.split('/');
                    return studentGrade === gradeFilter;
                });
            }

            if (filteredStudents.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</p>';
                return;
            }

            container.innerHTML = filteredStudents.map(student => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <div>
                        <div class="font-medium">${student.name}</div>
                        <div class="text-sm text-gray-600">‡∏£‡∏´‡∏±‡∏™: ${student.id} | ‡∏ä‡∏±‡πâ‡∏ô: ${student.class} | ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${student.balance.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <button onclick="deleteStudent('${student.id}')" class="text-red-500 hover:text-red-700 px-2 py-1 rounded">‡∏•‡∏ö</button>
                </div>
            `).join('');
        }

        function searchStudents() {
            updateStudentsList();
        }

        function filterStudents() {
            updateStudentsList();
        }

        // Bulk removal functions
        let selectedStudentsForRemoval = new Set();

        function updateRemoveStudentList() {
            const grade = document.getElementById('removeGrade').value;
            const room = document.getElementById('removeRoom').value;
            const container = document.getElementById('removeStudentsList');
            
            selectedStudentsForRemoval.clear();
            updateSelectedCount();
            
            if (!grade || !room) {
                container.innerHTML = '<p class="text-gray-500 text-center">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>';
                return;
            }
            
            const filteredStudents = students.filter(student => {
                const [studentGrade, studentRoom] = student.class.split('/');
                return studentGrade === grade && studentRoom === room;
            });
            
            if (filteredStudents.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡∏µ‡πâ</p>';
                return;
            }
            
            container.innerHTML = filteredStudents.map(student => `
                <div class="flex items-center p-2 bg-gray-50 rounded-lg">
                    <input type="checkbox" id="student_${student.id}" onchange="toggleStudentSelection('${student.id}')" class="mr-3">
                    <label for="student_${student.id}" class="flex-1 cursor-pointer">
                        <div class="font-medium">${student.name}</div>
                        <div class="text-sm text-gray-600">‡∏£‡∏´‡∏±‡∏™: ${student.id} | ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${student.balance.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                    </label>
                </div>
            `).join('');
        }

        function toggleStudentSelection(studentId) {
            if (selectedStudentsForRemoval.has(studentId)) {
                selectedStudentsForRemoval.delete(studentId);
            } else {
                selectedStudentsForRemoval.add(studentId);
            }
            updateSelectedCount();
        }

        function toggleSelectAll() {
            const grade = document.getElementById('removeGrade').value;
            const room = document.getElementById('removeRoom').value;
            
            if (!grade || !room) return;
            
            const filteredStudents = students.filter(student => {
                const [studentGrade, studentRoom] = student.class.split('/');
                return studentGrade === grade && studentRoom === room;
            });
            
            const allSelected = filteredStudents.every(student => selectedStudentsForRemoval.has(student.id));
            
            if (allSelected) {
                // Deselect all
                filteredStudents.forEach(student => {
                    selectedStudentsForRemoval.delete(student.id);
                    const checkbox = document.getElementById(`student_${student.id}`);
                    if (checkbox) checkbox.checked = false;
                });
                document.getElementById('selectAllBtn').textContent = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î';
            } else {
                // Select all
                filteredStudents.forEach(student => {
                    selectedStudentsForRemoval.add(student.id);
                    const checkbox = document.getElementById(`student_${student.id}`);
                    if (checkbox) checkbox.checked = true;
                });
                document.getElementById('selectAllBtn').textContent = '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î';
            }
            
            updateSelectedCount();
        }

        function updateSelectedCount() {
            const count = selectedStudentsForRemoval.size;
            document.getElementById('selectedCount').textContent = `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ${count} ‡∏Ñ‡∏ô`;
            
            // Update select all button text
            const grade = document.getElementById('removeGrade').value;
            const room = document.getElementById('removeRoom').value;
            
            if (grade && room) {
                const filteredStudents = students.filter(student => {
                    const [studentGrade, studentRoom] = student.class.split('/');
                    return studentGrade === grade && studentRoom === room;
                });
                
                const allSelected = filteredStudents.length > 0 && filteredStudents.every(student => selectedStudentsForRemoval.has(student.id));
                document.getElementById('selectAllBtn').textContent = allSelected ? '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' : '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î';
            }
        }

        function removeSelectedStudents() {
            if (selectedStudentsForRemoval.size === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏≤‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö');
                return;
            }
            
            const selectedStudents = students.filter(s => selectedStudentsForRemoval.has(s.id));
            const studentNames = selectedStudents.map(s => s.name).join(', ');
            
            if (confirm(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n${studentNames}\n\n‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î`)) {
                // Remove students and their transactions
                students = students.filter(s => !selectedStudentsForRemoval.has(s.id));
                transactions = transactions.filter(t => !selectedStudentsForRemoval.has(t.studentId));
                
                localStorage.setItem('students', JSON.stringify(students));
                localStorage.setItem('transactions', JSON.stringify(transactions));
                
                // Clear selection and reset form
                selectedStudentsForRemoval.clear();
                document.getElementById('removeGrade').value = '';
                document.getElementById('removeRoom').value = '';
                document.getElementById('removeStudentsList').innerHTML = '<p class="text-gray-500 text-center">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>';
                document.getElementById('selectedCount').textContent = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 0 ‡∏Ñ‡∏ô';
                document.getElementById('selectAllBtn').textContent = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î';
                
                // Update other displays
                updateStudentsList();
                updateTransactionStudentSelect();
                updateHistoryStudentSelect();
                generateBalanceReport();
                
                alert(`‡πÄ‡∏≠‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ${selectedStudents.length} ‡∏Ñ‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
            }
        }

        function updateTransactionStudentSelect() {
            const grade = document.getElementById('transactionGrade').value;
            const room = document.getElementById('transactionRoom').value;
            const select = document.getElementById('transactionStudent');
            
            let options = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô --</option>';
            
            // Show only existing students (members only)
            let filteredStudents = students;
            
            if (grade || room) {
                filteredStudents = students.filter(student => {
                    const [studentGrade, studentRoom] = student.class.split('/');
                    
                    if (grade && studentGrade !== grade) return false;
                    if (room && studentRoom !== room) return false;
                    
                    return true;
                });
            }
            
            filteredStudents.forEach(student => {
                options += `<option value="${student.id}">${student.name} (${student.class}) - ‡∏¢‡∏≠‡∏î: ${student.balance.toLocaleString()} ‡∏ö‡∏≤‡∏ó</option>`;
            });
            
            select.innerHTML = options;
        }

        function updateHistoryStudentSelect() {
            const grade = document.getElementById('historyGrade').value;
            const room = document.getElementById('historyRoom').value;
            const select = document.getElementById('historyStudent');
            
            let filteredStudents = students;
            
            if (grade || room) {
                filteredStudents = students.filter(student => {
                    const [studentGrade, studentRoom] = student.class.split('/');
                    
                    if (grade && studentGrade !== grade) return false;
                    if (room && studentRoom !== room) return false;
                    
                    return true;
                });
            }
            
            let options = '<option value="">-- ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô --</option>';
            
            // Add existing students only
            filteredStudents.forEach(student => {
                options += `<option value="${student.id}">${student.name} (${student.class})</option>`;
            });
            
            select.innerHTML = options;
        }

        // Transaction processing
        function processTransaction(event) {
            event.preventDefault();
            const studentId = document.getElementById('transactionStudent').value;
            const date = document.getElementById('transactionDate').value;
            const type = document.getElementById('transactionType').value;
            const amount = parseFloat(document.getElementById('transactionAmount').value);
            const note = document.getElementById('transactionNote').value;

            const student = students.find(s => s.id === studentId);
            if (!student) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô');
                return;
            }

            // Check if withdrawal amount exceeds balance
            if (type === 'withdraw' && amount > student.balance) {
                alert('‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô');
                return;
            }

            const transaction = {
                id: Date.now().toString(),
                studentId: studentId,
                studentName: student.name,
                date: date,
                type: type,
                amount: amount,
                note: note,
                timestamp: new Date().toISOString()
            };

            transactions.push(transaction);

            // Update student balance
            if (type === 'deposit') {
                student.balance += amount;
            } else {
                student.balance -= amount;
            }

            localStorage.setItem('students', JSON.stringify(students));
            localStorage.setItem('transactions', JSON.stringify(transactions));

            // Reset form
            document.getElementById('transactionStudent').value = '';
            document.getElementById('transactionAmount').value = '';
            document.getElementById('transactionNote').value = '';

            alert(`${type === 'deposit' ? '‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô' : '‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô'}‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${amount.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
        }

        // Daily summary
         function generateDailySummary() {
            const date = document.getElementById('summaryDate').value;
            const grade = document.getElementById('summaryGrade').value;
            const room = document.getElementById('summaryRoom').value;
            if (!date) return;

            let dayTransactions = transactions.filter(t => t.date === date);

            if (grade || room) {
                dayTransactions = dayTransactions.filter(t => {
                    const student = students.find(s => s.id === t.studentId);
                    if (!student) return false;
                    
                    const [studentGrade, studentRoom] = student.class.split('/');
                    
                    if (grade && studentGrade !== grade) return false;
                    if (room && studentRoom !== room) return false;
                    
                    return true;
                });
            }

            const container = document.getElementById('dailySummaryResult');

            if (dayTransactions.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>';
                return;
            }

            const deposits = dayTransactions.filter(t => t.type === 'deposit');
            const withdrawals = dayTransactions.filter(t => t.type === 'withdraw');
            const totalDeposit = deposits.reduce((sum, t) => sum + t.amount, 0);
            const totalWithdraw = withdrawals.reduce((sum, t) => sum + t.amount, 0);

            container.innerHTML = `
                <div class="grid md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-green-800">‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏£‡∏ß‡∏°</h3>
                        <p class="text-2xl font-bold text-green-600">${totalDeposit.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                        <p class="text-sm text-green-600">${deposits.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-red-800">‡∏¢‡∏≠‡∏î‡∏ñ‡∏≠‡∏ô‡∏£‡∏ß‡∏°</h3>
                        <p class="text-2xl font-bold text-red-600">${totalWithdraw.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                        <p class="text-sm text-red-600">${withdrawals.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-blue-800">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</h3>
                        <p class="text-2xl font-bold text-blue-600">${(totalDeposit - totalWithdraw).toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                        <p class="text-sm text-blue-600">${dayTransactions.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°</p>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="border border-gray-300 px-4 py-2 text-left">‡πÄ‡∏ß‡∏•‡∏≤</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                <th class="border border-gray-300 px-4 py-2 text-right">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${dayTransactions.map(t => `
                                <tr>
                                    <td class="border border-gray-300 px-4 py-2">${new Date(t.timestamp).toLocaleTimeString('th-TH')}</td>
                                    <td class="border border-gray-300 px-4 py-2">${t.studentName}</td>
                                    <td class="border border-gray-300 px-4 py-2">
                                        <span class="px-2 py-1 rounded text-sm ${t.type === 'deposit' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                            ${t.type === 'deposit' ? '‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô' : '‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô'}
                                        </span>
                                    </td>
                                    <td class="border border-gray-300 px-4 py-2 text-right">${t.amount.toLocaleString()}</td>
                                    <td class="border border-gray-300 px-4 py-2">${t.note || '-'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // History filtering
        function filterHistory() {
            const studentId = document.getElementById('historyStudent').value;
            const grade = document.getElementById('historyGrade').value;
            const room = document.getElementById('historyRoom').value;
            const date = document.getElementById('historyDate').value;
            const container = document.getElementById('historyResult');

            let filteredTransactions = transactions;

            if (studentId) {
                filteredTransactions = filteredTransactions.filter(t => t.studentId === studentId);
            }

            if (grade || room) {
                filteredTransactions = filteredTransactions.filter(t => {
                    const student = students.find(s => s.id === t.studentId);
                    if (!student) return false;
                    
                    const [studentGrade, studentRoom] = student.class.split('/');
                    
                    if (grade && studentGrade !== grade) return false;
                    if (room && studentRoom !== room) return false;
                    
                    return true;
                });
            }

            if (date) {
                filteredTransactions = filteredTransactions.filter(t => t.date === date);
            }

            if (filteredTransactions.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</p>';
                return;
            }

            // Sort by timestamp descending
            filteredTransactions.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            container.innerHTML = `
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="border border-gray-300 px-4 py-2 text-left">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">‡πÄ‡∏ß‡∏•‡∏≤</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                            <th class="border border-gray-300 px-4 py-2 text-right">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredTransactions.map(t => {
                            const student = students.find(s => s.id === t.studentId);
                            return `
                            <tr>
                                <td class="border border-gray-300 px-4 py-2">${new Date(t.date).toLocaleDateString('th-TH')}</td>
                                <td class="border border-gray-300 px-4 py-2">${new Date(t.timestamp).toLocaleTimeString('th-TH')}</td>
                                <td class="border border-gray-300 px-4 py-2">${t.studentName}</td>
                                <td class="border border-gray-300 px-4 py-2">${student ? student.class : '-'}</td>
                                <td class="border border-gray-300 px-4 py-2">
                                    <span class="px-2 py-1 rounded text-sm ${t.type === 'deposit' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                        ${t.type === 'deposit' ? '‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô' : '‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô'}
                                    </span>
                                </td>
                                <td class="border border-gray-300 px-4 py-2 text-right">${t.amount.toLocaleString()}</td>
                                <td class="border border-gray-300 px-4 py-2">${t.note || '-'}</td>
                            </tr>
                        `}).join('')}
                    </tbody>
                </table>
            `;
        }

        // Balance report
        function generateBalanceReport() {
            const grade = document.getElementById('balanceGrade').value;
            const room = document.getElementById('balanceRoom').value;
            const container = document.getElementById('balanceResult');

            if (students.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>';
                return;
            }

            let filteredStudents = students;

            if (grade || room) {
                filteredStudents = students.filter(student => {
                    const [studentGrade, studentRoom] = student.class.split('/');
                    
                    if (grade && studentGrade !== grade) return false;
                    if (room && studentRoom !== room) return false;
                    
                    return true;
                });
            }

            if (filteredStudents.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</p>';
                return;
            }

            // Sort students by balance descending
            const sortedStudents = [...filteredStudents].sort((a, b) => b.balance - a.balance);
            const totalBalance = filteredStudents.reduce((sum, s) => sum + s.balance, 0);

            container.innerHTML = `
                <div class="mb-4 p-4 bg-blue-50 rounded-lg">
                    <h3 class="font-semibold text-blue-800">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                    <p class="text-2xl font-bold text-blue-600">${totalBalance.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                </div>
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="border border-gray-300 px-4 py-2 text-left">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</th>
                            <th class="border border-gray-300 px-4 py-2 text-right">‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                            <th class="border border-gray-300 px-4 py-2 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${sortedStudents.map(student => `
                            <tr>
                                <td class="border border-gray-300 px-4 py-2">${student.id}</td>
                                <td class="border border-gray-300 px-4 py-2">${student.name}</td>
                                <td class="border border-gray-300 px-4 py-2">${student.class}</td>
                                <td class="border border-gray-300 px-4 py-2">${student.joinDate ? new Date(student.joinDate).toLocaleDateString('th-TH') : '-'}</td>
                                <td class="border border-gray-300 px-4 py-2 text-right font-semibold ${student.balance > 0 ? 'text-green-600' : student.balance < 0 ? 'text-red-600' : 'text-gray-600'}">${student.balance.toLocaleString()}</td>
                                <td class="border border-gray-300 px-4 py-2 text-center">
                                    <span class="px-2 py-1 rounded text-sm ${student.balance > 0 ? 'bg-green-100 text-green-800' : student.balance < 0 ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-800'}">
                                        ${student.balance > 0 ? '‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏ù‡∏≤‡∏Å' : student.balance < 0 ? '‡∏ï‡∏¥‡∏î‡∏•‡∏ö' : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏¢‡∏≠‡∏î'}
                                    </span>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // Export data to CSV
        function exportData() {
            const csvContent = '\uFEFF' + generateCSV();
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `student_savings_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        

        function generateCSV() {
            let csv = '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•,‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô,‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•,‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô,‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà,‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£,‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô,‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠,‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏\n';
            
            // Add student data
            students.forEach(student => {
                csv += `‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô,${student.id},"${student.name}",${student.class},,,,"${student.balance}",\n`;
            });

            // Add transaction data
            transactions.forEach(transaction => {
                const student = students.find(s => s.id === transaction.studentId);
                csv += `‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£,${transaction.studentId},"${transaction.studentName}",${student ? student.class : ''},${transaction.date},${transaction.type === 'deposit' ? '‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô' : '‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô'},"${transaction.amount}",,${transaction.note || ''}\n`;
            });

            return csv;
        }

        function exportSummaryOfSelectedClass() {
            const grade = document.getElementById('summaryGrade').value;
            const room = document.getElementById('summaryRoom').value;

            if (!grade || !room) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô");
                return;
            }

            const classKey = `${grade}/${room}`;
            const filteredStudents = students.filter(s => s.class === classKey);
            if (filteredStudents.length === 0) {
                alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ");
                return;
            }

            const summaryMap = {};

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            filteredStudents.forEach(student => {
                summaryMap[student.id] = {
                    name: student.name,
                    class: student.class,
                    depositTotal: 0,
                    withdrawTotal: 0,
                    lastDate: null
                };
            });

            // ‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡πÅ‡∏•‡∏∞‡∏´‡∏≤‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            transactions.forEach(t => {
                const entry = summaryMap[t.studentId];
                if (!entry) return;

                if (t.type === 'deposit') entry.depositTotal += t.amount;
                if (t.type === 'withdraw') entry.withdrawTotal += t.amount;

                const tranDate = new Date(t.date);
                if (!entry.lastDate || tranDate > new Date(entry.lastDate)) {
                    entry.lastDate = t.date;
                }
            });

            // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ß‡∏±‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î)
            const now = new Date();
            const downloadDate = now.toLocaleDateString('th-TH');
            const downloadTime = now.toLocaleTimeString('th-TH');

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á CSV
            let csv = `‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: ${classKey}\n‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${downloadDate} ‡πÄ‡∏ß‡∏•‡∏≤ ${downloadTime}\n\n`;
            csv += '‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•,‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô,‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏£‡∏ß‡∏°,‡∏¢‡∏≠‡∏î‡∏ñ‡∏≠‡∏ô‡∏£‡∏ß‡∏°,‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥,‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î\n';

            Object.values(summaryMap).forEach(entry => {
                const net = entry.depositTotal - entry.withdrawTotal;
                const last = entry.lastDate
                    ? new Date(entry.lastDate).toLocaleDateString('th-TH')
                    : '-';
                csv += `"${entry.name}",${entry.class},${entry.depositTotal.toFixed(2)},${entry.withdrawTotal.toFixed(2)},${net.toFixed(2)},${last}\n`;
            });

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `‡∏™‡∏£‡∏∏‡∏õ‡∏´‡πâ‡∏≠‡∏á_${classKey.replace('/', '-')}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }


    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96659ecb923e7b62',t:'MTc1MzcxODc1MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
